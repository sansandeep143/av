!function(){function e(){if("http://localhost:3000"!=d&&"http://10.0.2.2:3000"!=d)return!1;for(var e=0;e<arguments.length;e++)console.log(arguments[e])}function t(t){var r=t;e("Match:",t);var n=r.match(/powr-[^\s\]]*/i),o=r.match(/label="[^"]*"/i);null==o&&(o=r.match(/label='[^']*'/i)),null==o&&(o="");var a='<div class="'+n+'" '+o+"></div>";return e("Result is:"+a),a}function r(e){var t={},r=e.search("\\?");e=e.substr(r+1);for(var n=e.split("&"),o=0;o<n.length;o++){var a=n[o].split("=");if("undefined"==typeof t[a[0]])t[a[0]]=a[1];else if("string"==typeof t[a[0]]){var i=[t[a[0]],a[1]];t[a[0]]=i}else t[a[0]].push(a[1])}return t}function n(e){for(var t=!1,r=e;r&&r!==document;r=r.parentNode)if(void 0!=r.classList&&r.classList.contains("powr-ignore")){t=!0;break}return t}function o(){try{return window.top.location.href}catch(t){return e("Couldn't get page url:",t),""}}function a(e,t,r){function n(){var n={message:"loaded",data:{iframe_index:t}};e.contentWindow.postMessage(JSON.stringify(n),r)}e.addEventListener?e.addEventListener("load",n):e.attachEvent("onload",n)}function i(t){if(e("Keydown is: ",t),80==t.keyCode&&(u=!0,setTimeout(function(){u=!1},2e3)),38==t.keyCode&&u){for(var r=0;r<POWR_RECEIVERS.length;r++)POWR_RECEIVERS[r].receiver.postMessage(JSON.stringify({message:"showEdit"}),POWR_RECEIVERS[r].url);return t.preventDefault(),!1}if(40==t.keyCode&&u){for(var r=0;r<POWR_RECEIVERS.length;r++)POWR_RECEIVERS[r].receiver.postMessage(JSON.stringify({message:"hideEdit"}),POWR_RECEIVERS[r].url);return t.preventDefault(),!1}}var d="https://www.powr.io",l=0;POWR_RECEIVERS=[],loadPowr=function(){function i(t){e("Settings got a message!",t);try{var r=JSON.parse(t.data);if("viewLoaded"==r.message)e("Settings received view loaded");else if("updateSize"==r.message)if("undefined"!=typeof gadgets&&"undefined"!=typeof gadgets.window&&"undefined"!=typeof gadgets.window.adjustHeight)gadgets.window.adjustHeight(r.data.height);else{var n=r.data.iframe_index,o=document.querySelectorAll('[powrindex="'+n+'"]')[0];o.height=r.data.height+"px",o.style.height=r.data.height+"px",e("Updating size of el",o)}}catch(a){e("Error with message",a)}}for(var s=null,u=null,c=null,v=!1,p=document.querySelectorAll("script"),f=0;f<p.length;f++){var w=p[f],g=w.getAttribute("src");if(void 0!=g){var h=w.getAttribute("powr-token"),m=w.getAttribute("external-type");if(v=w.getAttribute("demo-mode"),void 0!=h?(e("Setting query to powr token attribute: "+h),s=h):g.search("powr-token")>-1&&(c=r(g),e("powr token present in query, query obj: ",c),void 0!==c["powr-token"]&&c["powr-token"].length>0&&(s=c["powr-token"])),void 0!=s){void 0!=m?u=m:g.search("external-type")>-1&&(c=r(g),void 0!=c["external-type"]&&c["external-type"].length>0&&(u=c["external-type"]));break}}}(null==s||0==s.length)&&(s=window.top.location.host),e("Powr token is "+s+"; external type is "+u);var y=!0;if(y){for(var E=/\[powr-[^\]]*\]/gi,b=/\[powr-[^\s\]]*/gi,R=document.querySelectorAll("a"),f=0;f<R.length;f++){var S=R[f];if(!n(S)){var L=S.previousSibling,C=S.nextSibling;if(L&&C&&S.getAttribute("href")&&S.getAttribute("href").search("tel")>-1&&3==L.nodeType&&3==C.nodeType&&L.nodeValue.match(b)&&C.nodeValue.search("]")>-1){var k=S.innerHTML,A=L.nodeValue.match(/powr-[^\s\]]*/gi)[0],x=document.createElement("div");x.innerHTML='<div class="'+A+'" label="'+k+'"></div>',L.remove(),C.remove(),S.parentNode.replaceChild(x,S)}}}for(var R=document.querySelectorAll("body, body *"),f=0;f<R.length;f++){var S=R[f],_=S.childNodes;if(!n(S))for(var I=0;I<_.length;I++){var N=_[I];if(3==N.nodeType){var P=N.nodeValue,O=P.replace(E,t);if(O!=P){var x=document.createElement("div");x.innerHTML=O,S.replaceChild(x,N)}}}}}if(0==document.querySelectorAll("#powrIframeLoader").length){var V=document.createElement("div"),T=document.getElementsByTagName("base")[0]||document.getElementsByTagName("script")[0];V.id="powrIframeLoader",V.innerHTML="&shy;<style> .powrLoaded iframe { visibility: hidden; } </style>",T.parentNode.insertBefore(V,T)}for(var W=document.querySelectorAll("[class*=powr-]"),f=0;f<W.length;f++){var q=W[f];if(!(n(q)||q.className.search("powrLoaded")>-1)){q.className+=" powrLoaded";for(var M=q.className.split(/\s+/),f=0;f<M.length;f++)if(0===M[f].toLowerCase().search("powr-")){var H=M[f].toLowerCase().replace("powr-","");break}if("undefined"==typeof H)return;var B=q.getAttribute("label");void 0==B&&(B="");var J="true"==v||"true"==q.getAttribute("demo-mode")?!0:!1,j=d+"/plugins/"+H+"/view?powr_token="+s+"&user_label="+encodeURIComponent(B)+"&demo_mode="+J;void 0!=u&&(j+="&external_type="+u),e("page url IS "+o()),o()&&(j+="&url="+encodeURIComponent(o()));var z=document.createElement("iframe");z.src=j,z.setAttribute("powrindex",l),z.width="100%",z.height="100%",z.frameBorder="0",z.style.visibility="visible",z.setAttribute("webkitallowfullscreen",""),z.setAttribute("mozallowfullscreen",""),z.setAttribute("allowfullscreen",""),a(z,l,j),q.appendChild(z);var U=z.contentWindow;POWR_RECEIVERS.push({receiver:U,url:j}),l++,window.addEventListener?window.addEventListener("message",i):window.attachEvent("onmessage",i)}}};for(var s=0;10>s;s++)setTimeout(function(){loadPowr()},2e3*s);window.addEventListener?window.addEventListener("load",loadPowr):window.attachEvent("onload",loadPowr);var u=!1;window.addEventListener?window.addEventListener("keydown",i):window.attachEvent("onkeydown",i)}();